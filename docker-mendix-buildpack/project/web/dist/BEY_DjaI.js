import{n as A,m as D,h as P,P as I,g as R,K as C,L as E,T as j,R as F,N as G,M as x,$ as K,a2 as M,a3 as k,l as H,a4 as J,a5 as U,a6 as W,a7 as X,b as Z,a8 as _,V,a9 as q,t as B,aa as N,ab as Q,ac as Y,ad as T,ae as ee,af as te,ag as z}from"./DTxgj959.js";import{y as ae}from"./C1Yo2GSP.js";import{u as oe}from"./DmSe-73H.js";import{r as se}from"./D-Sagn14.js";import{n as ne}from"./BXK2Gcku.js";import"./DWFzDMGp.js";const ie=A.get().getLogger(),re=D((t,c,r,p)=>{const l=oe(t),y=`List attribute "${r}/${p}"`;function s(u,d){const $=E(u,t.attribute,c),v=j(d,()=>{const g=F($.dependOn(),m=>m.access===G.None?(function(w,O){ie.debug(`No access to attribute "${w.attribute}" of entity "${w.entity}" in widget ${x(O)}.`)}(t,r),K()):I(m.value)),f=M(g,void 0),h=l.formatter,S=f instanceof Array&&t.isList?f.map(m=>h.format(m)).join(", "):h.format(f);return{status:g.status,value:f,displayValue:S,formatter:h,readOnly:!0,setFormatter:()=>L("setFormatter",r),setValue:()=>L("setValue",r),setTextValue:()=>L("setTextValue",r),validation:void 0,setValidator:()=>L("setValidator",r),isList:t.isList}});return k(v,({value:g,displayValue:f})=>({value:g,displayValue:f}))}return ae(function(u){const d=P(I(u)),$=`${y} for object ${u.getGuid()}`;return t.isList?s(R(d,t.path,c),$):s(t.path?C(d,t.path,c):d,$)},y,t.dataSourceId,l)});function L(t,c){throw new Error(`Widget ${x(c)} is attempting to call "${t}". This operation is not yet supported on attributes linked to a datasource.`)}const ue=D(({selectionType:t,dataSourceId:c,onChange:r},p,l,y)=>{const s=`${l}/${y}`,[u,d]=p.useSlot(l,"selection"),[$]=p.useSlot(l,`${c}/items`),[v,g]=H(`Selected item map of ${s}`,{}),f=J(`Data source items for ${s}`,j(`Data source items by GUID for ${s}`,()=>{const o=$.dependOn()??U();return W(o,z)}),o=>{if(o.status==="loading")return;const a=N(V(u)),e=V(v),n=M(o,{}),b=a.map(i=>n[i]??e[i]).filter(i=>i!==void 0).filter(S??(i=>i.id in n));se(()=>m(b))}),h=function(){if(!r)return;const o=X(r.argMap,p,l),[a]=p.useSlot(Z,"form");return(e,n)=>{_(e,n)||ne(o,a,r,l)}}();let S;switch(t){case"Single":return O();case"Multi":return V(u)===void 0&&d([]),O()}function m(o){const a=o.map(b=>b.id),e=t==="Single"?a[0]:a,n=V(u);d(e),g(z(o)),h?.(e,n)}function w(o){if(!function(e){return t==="Single"&&(e===void 0||Q(e))||t==="Multi"&&Y(e)}(o))throw new T(`Value ${o} is not assignable to selection of type ${t}. (${s})`);const a=N(o);if(a.some(e=>!ee(e,c)))throw new T(`An ObjectItem can only be passed to a selection property that belongs to the same data source. (${s})`);if(a.length>1&&new Set(a.map(e=>e.id)).size!==a.length)throw new T(`A multi-selection may not contain duplicate objects. (${s})`);te(()=>m(a))}function O(){const o=q(`Selected items from data source of ${s}`,()=>{const a=N(u.dependOn()),e=v.dependOn(),n=M(f.dependOn(),{}),b=a.map(i=>n[i]??e[i]).filter(i=>i!==void 0);return b.length===a.length?b:Object.values(e)});return j(`Selection value of ${s}`,()=>{const a=(e=o.dependOn(),t==="Single"?e[0]:e);var e;return{type:t,name:s,selection:Object.freeze(a),setSelection:B(n=>w(n)),setKeepSelection(n){S=n}}})}});export{ue as N,re as R};
