import{r as h,O as d,b6 as z,a1 as W,b7 as M,b8 as J,b9 as q,_ as H,ba as X,bb as Z,ax as S,bc as T,bd as _,be as N,ak as G,V as P,S as b,am as D,bf as Y,B as ee,f as te}from"./DTxgj959.js";import{C as ne}from"./DWFzDMGp.js";var w,v;(function(n){n[n.UpDown=0]="UpDown",n[n.LeftRight=1]="LeftRight"})(w||(w={})),function(n){n[n.FORWARD=0]="FORWARD",n[n.BACKWARD=1]="BACKWARD"}(v||(v={}));class se{constructor(e,t,i=V){this.children=[],this.currentIndex=-1,this.focused=!1,this.updating=!1,this.shiftingFocus=!1,this.mutationObserver=new MutationObserver(this.onMutation.bind(this)),this.keys=e,this.container=t,this.childQuery=i,this.keyListener=this.createKeyListener(),this.focusInListener=this.createFocusInListener(),this.focusOutListener=this.createFocusOutListener(),this.addListeners(),this.handleMutation()}onMutation(e){this.handleMutation()}handleMutation(){const e=(t=this.childQuery(this.container),Array.isArray(t)?t:Array.from(t).filter(i=>i instanceof HTMLElement)).filter(i=>!i.hasAttribute("data-roving-inactive"));var t;this.doWithoutMutations(()=>this.updateChildren(e))}setChildQuery(e=V){this.childQuery=e}setOnActiveRowChange(e){this.onActiveRowChange=e}setContainer(e){this.container!==e&&(this.removeListeners(),this.container=e,this.addListeners(),this.handleMutation())}updateChildren(e){const t=this.getCurrentElement();if(function(i,o){if(g=i,C=o,g.length===C.length&&g.every((f,L)=>f===C[L]))return!1;var g,C;const A=new Set;return i.forEach(f=>A.add(f)),o.forEach(f=>{A.delete(f)||f.setAttribute("data-roving-tabindex","")}),A.forEach(f=>j(f)),!0}(this.children,e)&&(this.children=e.slice()),t){const i=e.indexOf(t);if(this.setCurrentIndex(i!==-1?i:this.findValidIndex(!1,0)),this.focused){const o=this.getCurrentElement();setTimeout(()=>this.restoreFocus(t!==o),0)}}else this.updateTabIndices();this.updateState()}restoreFocus(e){if(this.shiftingFocus&&!e)return;const t=z(),i=this.getCurrentElement();(e||!t||i&&i!==t&&i.contains(t))&&this.focusCurrentElement()}updateState(){const e=this.getCurrentElement();e&&p(e)||(this.setCurrentIndex(this.findValidIndex()),this.focused&&this.focusCurrentElement())}destroy(){this.mutationObserver.disconnect(),this.removeListeners(),this.children.forEach(j)}addListeners(){this.container.addEventListener("keydown",this.keyListener),this.container.addEventListener("focusin",this.focusInListener),this.container.addEventListener("focusout",this.focusOutListener)}removeListeners(){this.container.removeEventListener("keydown",this.keyListener),this.container.removeEventListener("focusin",this.focusInListener),this.container.removeEventListener("focusout",this.focusOutListener)}doWithoutMutations(e){const t=this.updating;t||(this.updating=!0,this.mutationObserver.disconnect()),e(),t||(this.mutationObserver.observe(this.container,{childList:!0,attributes:!0,subtree:!0}),this.updating=!1)}createKeyListener(){return e=>{const t=this.getNavigationCommand(e);if(t!==null){e.preventDefault();const i=t.valueOf()===v.BACKWARD.valueOf();this.setCurrentIndex(this.findValidIndex(i)),this.focusCurrentElement()}}}createFocusInListener(){return e=>{const t=W(d(e.target));let i=-1,o=t;for(;o&&(i=this.children.indexOf(o),i===-1);)o=o.parentElement;i!==-1&&this.setCurrentIndex(i),t&&t!==o&&!M(t)&&window.setTimeout(()=>this.focusCurrentElement(),0),this.focused=!0}}createFocusOutListener(){return e=>{const t=this.getCurrentElement(),i=W(d(e.relatedTarget??document.activeElement));this.shiftingFocus=!0,i&&this.container.contains(i)||window.setTimeout(()=>{this.focused=!1},0),d(e.target)===t&&window.setTimeout(()=>{p(t)&&t.parentNode!==null||this.doWithoutMutations(()=>{this.updateState(),this.focusCurrentElement()})},0),window.setTimeout(()=>{this.shiftingFocus=!1},0)}}getNavigationCommand(e){switch(this.keys){case w.UpDown:switch(e.key){case"ArrowUp":case"Up":return v.BACKWARD;case"ArrowDown":case"Down":return v.FORWARD}break;case w.LeftRight:{const t=J();switch(e.key){case"ArrowLeft":case"Left":return t?v.FORWARD:v.BACKWARD;case"ArrowRight":case"Right":return t?v.BACKWARD:v.FORWARD}break}}return null}setCurrentIndex(e){this.currentIndex=e,this.updateTabIndices(),this.onActiveRowChange&&this.onActiveRowChange(e)}focusCurrentElement(){const e=this.getCurrentElement();e&&e.focus()}updateTabIndices(){this.doWithoutMutations(()=>{this.children.forEach((e,t)=>e.setAttribute("tabindex",t===this.currentIndex?"0":"-1"))})}findValidIndex(e=!1,t=1,i=this.currentIndex){const o=e?K(this.children,p,i-t):B(this.children,p,i+t);return o!==-1?o:e?B(this.children,p):K(this.children,p)}getCurrentElement(){return this.currentIndex!==-1?this.children[this.currentIndex]:null}}function j(n){n.removeAttribute("tabindex"),n.removeAttribute("data-roving-tabindex")}function B(n,e,t=0){const i=n.slice(t).findIndex(e);return i===-1?-1:i+t}function K(n,e,t=n.length-1){const i=n.slice(0,t+1).reverse().findIndex(e);return i===-1?-1:t-i}function V(n,e=[]){for(let t=0,i=n.children.length;t<i;t++){const o=n.children.item(t);q(o)&&((o.hasAttribute("data-roving-tabindex")||M(o))&&e.push(o),V(o,e))}return e}function p(n){return function(e){const t=window.getComputedStyle(e);return t.visibility==="visible"&&t.display!=="none"}(n)&&function(e){return!e.disabled}(n)}function ie(n,e,t){h.useLayoutEffect(()=>{const i=new se(e,d(n.current),t);return()=>i.destroy()},[n,e,t])}function re(n){const e=h.useState(()=>H())[0],[t,i,o]=function(r,s){const u=h.useRef(void 0),l=h.useCallback(c=>{r&&!r.readOnly&&r.setValue(new X(c+1))},[r?.readOnly,r?.setValue]);if(!r)return[s,!1,()=>{}];const a=Math.max(r.value?.toNumber()??0,0),x=u.current!==a;return x&&(u.current=a),[a-1,x,l]}(n.activeTab,n.defaultTab),[g,C,A]=function(r,s,u,l){const[a,x]=ne("selectedTab",s);let c=a>=r.length?-1:a;if(c!==-1){for(;!I(d(r[c]))&&(c=(c+1)%r.length,c!==a););c!==a&&x(c)}const m=h.useRef(c),$=m.current!==c;m.current=c,u&&s!==-1&&s+1<=r.length&&m.current!==s&&E(s,!1);const k=Z();function E(y,Q=!0){y===c?(m.current=-1,k()):(x(y),Q&&l(y))}return S(c,$,E)}(n.tabs,t,i,o),f=function(r,s,u){const l=h.useRef(r.map(a=>!a.isDelayed&&I(a)?{key:0}:"hidden"));if(s!==-1){const a=d(l.current[s]);a==="hidden"?l.current[s]={key:0}:u&&d(r[s]).refreshOnShow&&(a.key+=1)}return l.current}(n.tabs,g,C),[L,U]=function(r,s){const[u,l]=h.useState(()=>T(s,()=>0)),a=h.useRef(T(s,()=>{}));function x(c,m){a.current[m]?.();const $=c.getAll$("isInvalid");a.current[m]=te(()=>$.dependOn().filter(Boolean).length,k=>{l(E=>{const y=[...E];return y[m]=k,y})},{fireImmediately:!1,name:`Validation of tab ${m} of ${r}`})}return h.useEffect(()=>()=>a.current.forEach(c=>c?.()),[]),S(u,x)}(n.name,n.tabs.length),F=h.useRef(null),R=h.useRef(null),O=h.useRef(null);return ie(R,w.LeftRight,h.useCallback(r=>r.querySelectorAll("a"),[])),_(F,h.useCallback(function(r){const s=d(O.current);if(!r)return s.style.height="auto",void(s.style.overflow="");const u=N(r),l=N(d(R.current)),a=u.contentBox.height-l.marginBox.height;a>100?(s.style.height=`${a}px`,s.style.overflow="auto"):(s.style.height="auto",s.style.overflow="")},[O,R])),n.hoistedSelections?.forEach(r=>{const[s,u]=G(r,"selection");u(P(s))}),b.jsxs("div",{className:D("mx-tabcontainer",n.class),style:n.style,"data-focusindex":n.tabIndex,ref:F,children:[b.jsx("ul",{className:"nav nav-tabs mx-tabcontainer-tabs",role:"tablist",ref:R,children:n.tabs.map((r,s)=>I(r)?b.jsxs("li",{className:D({active:g===s}),role:"presentation",onClick:u=>{A(s),u.preventDefault()},children:[b.jsxs("a",{href:"#",className:`mx-name-${r.name}`,id:`${e}-t${s}`,"aria-controls":`${e}-p${s}`,role:"tab","aria-selected":g===s,children:[r.caption.value,r.badge&&b.jsx("span",{className:"mx-tabcontainer-badge",style:{display:r.badge.value?"inline-block":"none"},children:r.badge.value})]}),d(L[s])>0&&b.jsx("span",{className:"mx-tabcontainer-indicator",children:L[s]})]},s):void 0)}),b.jsx("div",{className:"tab-content mx-tabcontainer-content","data-focusindex":"0",ref:O,children:n.tabs.map((r,s)=>{const u=d(f[s]),l=h.useMemo(()=>r.isVisible===void 0||!!r.isVisible.value,[r.isVisible]);return b.jsx("div",{className:D("tab-pane mx-tabcontainer-pane",{active:g===s}),style:I(r)?void 0:{display:"none"},id:`${e}-p${s}`,role:"tabpanel","aria-labelledby":`${e}-t${s}`,children:b.jsx(Y,{namespace:`${n.widgetId}.${s}`,setupStore:h.useCallback(a=>U(a,s),[]),children:u!=="hidden"&&l?b.jsx(ee,{renderKey:u.key,children:r.content}):null})},s)})})]})}function I(n){return!n.isVisible||n.isVisible.status==="loading"&&n.isVisible.value===void 0||!!n.isVisible.value}export{re as Z};
