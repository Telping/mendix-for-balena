import{n as at,m as st,l as w,T as c,b as nt,aK as ot,aL as rt,a7 as R,aA as y,t as $,V as o,aM as pt,x as ct,ad as V,aN as lt,O as dt,aO as ut,aP as B,aQ as ht,M as bt,aR as mt,aS as gt,Y as K,af as ft,S as l,aT as xt,r as vt,am as W}from"./DTxgj959.js";import{q as wt}from"./DWFzDMGp.js";const O=at.get().getLogger(),yt=st((e,t,i)=>N(e,t,i));function N(e,t,i,p,E){const[u,b]=w(`Actions in progress for ${i}`,0),k=c(`Action is executing for ${i}`,()=>u.dependOn()>0),[F]=t.useSlot(i,"isInvalid"),[G]=t.useSlot(nt,"form"),[q,z]=w(`External action parameters for ${i}`,void 0),m=ot(),j=m.hasSomeRole(e.action.config.allowedRoles),J=e.action.config.namedUser??!1,g=j&&!(J&&m.isGuest()),D=m.isGuest()&&!j,[Q,Y]=rt(e.action.argMap,a=>!("expression"in a)||!Object.values(a.expression.args).some(s=>s.source==="actionvariable")),[T,f]=w("Waiting for action arguments",!1),A=R(Q,t,i,p,e.action.type!=="deleteObject"),x=c(`Loadable status for parameters of action for ${i}`,()=>{const a=Object.values(A.dependOn());let s="available";for(const r of a){if(r.status==="unavailable")return"unavailable";r.status==="loading"&&(s="loading")}return s}),X=c(`Action for ${i} can execute`,()=>(g||D)&&x.dependOn()!=="unavailable"),I=c(`Action for ${i} can execute`,()=>(g||D)&&x.dependOn()==="available"),Z=c("Arguments which are predefined or supplied by widget ",()=>({...p?.dependOn(),...y(q.dependOn()??{},a=>({actionvariable:mt(a,"primitive")}))})),_=R(Y,t,i,Z,e.action.type!=="deleteObject",!0),P=e.action.disabledDuringExecution;return c(`Action value for ${i}`,()=>{const a=E?X.dependOn():I.dependOn(),s=k.dependOn()||T.dependOn();return{isAuthorized:g,canExecute:a,isExecuting:s,disabledDuringExecution:P,execute:$(r=>(E?tt:S)(r))}});function tt(a){o(T)?O.debug(`Widget is attempting to execute a ${e.action.type} action which is already waiting for parameters.`):(f(!0),gt(x,(s,r)=>{s==="available"?(f(!1),ft(()=>S(a)),r()):s==="unavailable"&&(f(!1),O.debug(`Widget is attempting to execute a ${e.action.type} action with parameters that became unavailable`),r())},!0))}function S(a){if(!o(I)||P&&o(k))return void O.debug(`Widget is attempting to execute a ${e.action.type} action which is not executable.`);(function(n,h){if(!h||Object.keys(h).length===0)return;const d=[],C=pt(Object.keys(h),Object.keys(n??{}));if(C.length>0&&d.push(`The action arguments are missing keys: ${C.join(", ")}.`),Object.entries(n??{}).forEach(([L,it])=>{const H=h[L];if(H)try{ct(it,H,!0,"Variable")}catch(v){if(!(v instanceof V))throw v;d.push(v.message)}else d.push(`'${L}' is not a valid key for an argument.`)}),d.length>0)throw new V(`${d.join(`
`)}`)})(a,e.argumentTypes),z(a);const s={...y({...o(A)},K),...lt(y({...o(_)},K),n=>(n&&"primitive"in n&&n.primitive!==void 0)??!1)},r=o(F),et=dt(o(G))[0];b(o(u)+1),wt(e.action,{abortOnClientValidations:!e.skipClientValidation,abortOnServerValidations:e.abortOnServerValidation??!1,widgetIsValid:!r,currentForm:et},s,$(()=>{b(o(u)-1)}),$(n=>{b(o(u)-1),n instanceof ut?B(n):n instanceof ht||B(new Error(`An error occurred while executing an action of ${bt(i)}: ${n.message}`))}))}}function U({icon:e,altText:t}){if(!e)return null;switch(e.type){case"image":return l.jsx("img",{src:e.iconUrl,alt:t??""});case"glyph":return l.jsx("span",{className:`glyphicon ${e.iconClass}`,...t?{"aria-label":t}:{"aria-hidden":!0}});case"icon":return l.jsx("span",{className:e.iconClass,...t?{"aria-label":t}:{"aria-hidden":!0}})}}class M extends vt.Component{constructor(){super(...arguments),this.state=this.deriveState(this.props,{disabled:!0,showDisabled:!1}),this.onClickHandler=this.onClick.bind(this),this.onKeyDownHandler=this.onKeyDown.bind(this)}UNSAFE_componentWillReceiveProps(t){this.setState(i=>this.deriveState(t,i))}componentDidMount(){this.actionButtonRef?.addEventListener("click",this.onClickHandler),this.context?.registerHandler(this.props.buttonId,()=>{this.props.action&&!this.state.disabled&&this.props.action.execute()})}componentWillUnmount(){this.actionButtonRef?.removeEventListener("click",this.onClickHandler),window.clearTimeout(this.disableTimeout),this.context?.unregisterHandler(this.props.buttonId)}onClick(t){this.suppressEvent(t),this.props.renderType==="button"&&this.actionButtonRef.focus(),this.executeAction()}executeAction(){this.props.action&&!this.state.disabled&&this.props.action.execute()}onKeyDown(t){t.key!=="Enter"&&t.key!==" "||(this.suppressEvent(t),this.executeAction())}suppressEvent(t){t.preventDefault(),this.props.action&&t.stopPropagation()}render(){return this.props.renderType==="button"?this.renderButton():this.renderLink()}renderButton(){const t=this.state.showDisabled?{"aria-disabled":!0}:{};return l.jsxs("button",{type:"button",className:W("btn","mx-button",this.props.class,this.props.buttonClass),style:this.props.style,title:this.props.tooltip.value,"aria-label":this.getAriaLabel(),tabIndex:this.props.tabIndex,disabled:!!this.props.action&&!this.props.action.canExecute,"data-button-id":this.props.buttonId,"data-disabled":this.state.disabled,ref:i=>this.actionButtonRef=i??void 0,...this.props.ariaProps?{"aria-haspopup":this.props.ariaProps.ariaHaspopup,"aria-expanded":this.props.ariaProps.ariaExpanded,"aria-controls":this.props.ariaProps.ariaControls}:null,...t,children:[this.renderIcon()," ",this.props.caption.value]})}renderLink(){const t=this.state.showDisabled?{"aria-disabled":!0}:{};return l.jsxs("a",{className:W("mx-link",this.props.class),style:this.props.style,href:"#",role:this.props.role,title:this.props.tooltip.value,"aria-label":this.getAriaLabel(),tabIndex:!this.props.action||this.props.action.canExecute?this.props.tabIndex:-1,onKeyDown:this.onKeyDownHandler,"data-button-id":this.props.buttonId,"data-disabled":this.state.disabled,ref:i=>this.actionButtonRef=i??void 0,...this.props.ariaProps?{"aria-haspopup":this.props.ariaProps.ariaHaspopup,"aria-expanded":this.props.ariaProps.ariaExpanded,"aria-controls":this.props.ariaProps.ariaControls}:null,...t,children:[this.renderIcon()," ",this.props.caption.value]})}getAriaLabel(){if(!this.props.caption.value&&this.props.tooltip.value)return this.props.tooltip.value}renderIcon(){return this.props.icon&&l.jsx(U,{icon:this.props.icon.value})}deriveState(t,i){const p=t.action;return p&&!p.canExecute?{disabled:!0,showDisabled:!0}:p?.isExecuting&&p.disabledDuringExecution?(this.disableTimeout===void 0&&(this.disableTimeout=window.setTimeout(()=>{this.setState({showDisabled:!0}),this.disableTimeout=void 0},1e3)),{disabled:!0,showDisabled:i.showDisabled}):(window.clearTimeout(this.disableTimeout),this.disableTimeout=void 0,{disabled:!1,showDisabled:!1})}}M.contextType=xt;export{N as U,M as a,yt as f,U as i};
