import{n as le,m as de,aU as ce,l as q,a3 as H,s as I,a7 as ve,b as D,T as A,t as L,V as w,aV as be,aW as fe,aX as pe,O as J,aA as U,q as X,g as ge,L as Y,R as G,a2 as Z,aY as me,M as y,h as Oe,P as M,K as $e,a4 as Q,aZ as Ve,a_ as he,a$ as ye,aP as W,b0 as Ee,b1 as ee,b2 as we,b3 as je,b4 as _,w as x,b5 as Re,aE as Te,N as C,$ as F,a6 as Ae,aQ as _e,Y as xe}from"./DTxgj959.js";import{q as Ne}from"./DWFzDMGp.js";import{i as Se}from"./D-Sagn14.js";function Ie(e,t,n){const o=te(e,t.validation);return(i,c,u)=>{const r=c.getAttributeType(t.attribute);return ae(i,n(i),r,u,t.validation,o)}}function te(e,t){return t?U(t.expression.args,n=>{Ee(n)||ee();const[o]=e.useSlot(n.widget,n.source);return()=>{const i=w(o);return i&&typeof i=="object"&&"status"in i?i.status==="available"?i.value:void 0:i}}):{}}function ae(e,t,n,o,i,c){return function(u,r){const d=we(u),v=je(d,r);if(v!==_.OK)return x("mendix.lib.Validations",J(Le[v]))}(t,n)??(o?o(e):void 0)??(i?function(u,r,d,v){if(!Re(v.expression,{...d,value:()=>{switch(r){case"ObjectReference":default:return u;case"ObjectReferenceSet":return ee()}}}))return v.message||x("mendix.lib.Validations","required_field")}(t,n,c,i):void 0)}const Le={[_.NOT_INTEGER]:"invalid_number",[_.RANGE_INTEGER]:"range_integer",[_.RANGE_LONG]:"range_long",[_.RANGE_DECIMAL]:"range_decimal"};function Pe(e,t,n){switch(n){case"Enum":case"Boolean":case"ObjectReference":case"ObjectReferenceSet":return x("mendix.lib.Validations","invalid_attribute",e,t);case"DateTime":return x("mendix.lib.Validations","invalid_date");case"Integer":case"Long":case"Decimal":return x("mendix.lib.Validations","invalid_number");default:throw new Error(`Attribute type ${n} is not supported.`)}}function ne(e,t,n,o,i,c,u,r){const[d,v]=q(`Invalid value of ${r}`,void 0),[m]=c.useSlot(D,"validationRequest"),[h,O]=q(`Local value validation of ${r}`,void 0),f=I(m),V=I(e),p=I(t),[,j]=c.useSlot(u,"isInvalid");return{validation$:Q(`Published validation of ${r}`,A(`Validation of ${r}`,()=>{const E=e.dependOn(),R=V.dependOn(),N=t.dependOn(),S=p.dependOn(),a=m.dependOn(),b=f.dependOn(),s=h.dependOn();if(E===R)return N!==S?N[0]:a!==b?function(){const l=w(e);if(l.status!=="available")return;const $=w(d)??n(l.value);try{return o($,l.value,i())}catch(T){return void function(g,P){W(new Error(`An error occurred while validating current value in ${y(g)}: ${P instanceof Error?P.message:P}`))}(u,T)}}():s}),E=>j(E!==void 0)),invalidValue$:d,setValidation:function(E,R){O(E),v(R)}}}function ie(e,t,n,o){return A(`Server validation of ${o}`,()=>{const i=e.dependOn();return i.status!=="available"?[void 0]:Te({guid:i.value.object.getGuid(),attr:t.attribute,val:!0,tag:`Validation of ${o}`},n)})}const K=le.get().getLogger(),qe=de((e,t,n,o)=>{const i=`${n}/${o}`,c=ce(e.entity,e.attribute,e.formatting??{}),u=oe(e.entity,e.attribute),[r,d]=q(`Formatter for ${i}`,c);if(e.isList)return H(De(e,t,n,i,r,d,c,u),a=>({value:a.value,displayValue:a.displayValue}));let v;const m=re(e,t,n,o,i),h=I(m),O=ie(m,e,t,i),f=function(a,b){const s=te(a,b.validation);return(l,$,T)=>{const g=$.getAttributeType(b.attribute);return l.state==="unparsed"?Pe(l.value,b.attribute,g):ae(l.value,l.value,g,T,b.validation,s)}}(t,e),{validation$:V,invalidValue$:p,setValidation:j}=ne(m,O,a=>({state:"parsed",value:a.attribute}),(a,b,s)=>f(a,b.object,s),()=>v,t,n,i),E=ve(e.onChange.argMap,t,n),[R]=t.useSlot(D,"form"),N=A(`Editable value of ${i}`,()=>{const a=m.dependOn();h.dependOn()!==a&&Se(()=>{j(void 0,void 0)});const b=V.dependOn(),s=p.dependOn(),l=r.dependOn(),$=a.status!=="available"||s!==void 0&&s.state==="unparsed"?void 0:s!==void 0?s.value:a.value.attribute,T=a.status!=="available"?"":s!==void 0&&s.state==="unparsed"?s.value:l.format(s!==void 0?s.value:a.value.attribute);return{status:a.status,value:$,displayValue:T,readOnly:a.status!=="available"||a.value.readOnly,validation:b,formatter:l,universe:u,isList:!1,setValidator:g=>{v=g},setValue:L(g=>a.status!=="available"?B(e,n):a.value.readOnly?k(e,n):S({state:"parsed",value:g},a.value)),setTextValue:L(g=>a.status!=="available"?B(e,n):a.value.readOnly?k(e,n):S({state:"unparsed",value:g},a.value)),setFormatter:L(g=>d(g??c))}});return H(N,a=>({value:a.value,displayValue:a.displayValue}));function S(a,b){if(a.state==="unparsed"){const s=b.attribute,l=w(r),$=l.type===be.DateTime&&s instanceof Date?l.parse(a.value,s):l.parse(a.value);a=$.valid?{state:"parsed",value:$.value}:a}else fe(a.value,e.entity,e.attribute);try{const s=b.object,l=f(a,s,v);if(l!==void 0)j(l,a);else{const $=s.get2(e.attribute);pe.structural($,a.value)?j(void 0,void 0):(s.set2(e.attribute,a.value),se(E,R,e.onChange,n))}}catch(s){Ge(n,s)}}});function se(e,t,n,o){const i=w(e),c=J(w(t))[0];setTimeout(()=>{Ne(n,{abortOnClientValidations:!0,abortOnServerValidations:!1,widgetIsValid:!0,currentForm:c},U(i,u=>Z(u,void 0)),void 0,u=>function(r,d){d instanceof _e||W(new Error(`An error occurred while executing On change at ${y(r)}: ${d.message}`))}(o,u))},0)}function De(e,t,n,o,i,c,u,r){const d=X(t,e.scope),v=ge(d,e.path,t),m=Y(v,e.attribute,t);return A(`Editable list value of ${o}`,()=>{const h=G(m.dependOn(),p=>p.access===C.None?(ue(e,n),F()):M(p.value)),O=Z(h,[]),f=i.dependOn(),V=O.map(p=>f.format(p)).join(", ");return{status:h.status,value:O,displayValue:V,readOnly:!0,validation:void 0,formatter:f,universe:r,isList:!0,setValidator:()=>z("setValidator",n),setValue:()=>z("setValue",n),setTextValue:()=>z("setTextValue",n),setFormatter:L(p=>c(p??u))}})}function re(e,t,n,o,i){const[c]=t.useSlot(D,"subtreeReadonly"),u=e.isEditable?me(`Conditional editability of ${y(n)}`,e.isEditable,t):Oe(M(!0)),r=X(t,e.scope),d=e.path?$e(r,e.path,t):r,v=Y(d,e.attribute,t),m=A(`Submitted value of ${i}`,()=>{const O=c.dependOn()??!1,f=d.dependOn();return G(v.dependOn(),V=>V.access===C.None?(ue(e,n),F()):Ae(u.dependOn(),p=>({object:xe(f),attribute:V.value,readOnly:V.access===C.Read||O||!p})))}),[,h]=t.useSlot(`${n}.${o}`,"editableObject");return Q(`Published editable object of ${i}`,m,O=>h(G(O,f=>f.readOnly?F():M(f.object))))}function oe(e,t){switch(Ve(e,t)){case"Enum":return he(ye(e,t));case"Boolean":return[!0,!1];default:return}}function B(e,t){K.debug(`Widget ${y(t)} is attempting to change the value of attribute "${e.attribute}" of entity "${e.entity}" which is not available.`)}function k(e,t){K.debug(`Widget ${y(t)} is attempting to change the value of attribute "${e.attribute}" of entity "${e.entity}" which is not writable.`)}function ue(e,t){K.debug(`No access to attribute "${e.attribute}" of entity "${e.entity}" in widget ${y(t)}.`)}function Ge(e,t){W(new Error(`An error occurred while validating new value set by ${y(e)}: ${t instanceof Error?t.message:t}`))}function z(e,t){throw new Error(`Widget ${y(t)} is attempting to call "${e}". This operation is not supported on attribute property with reference sets.`)}export{k as H,ne as i,qe as k,oe as l,se as n,Ie as q,ie as s,re as u,B as z};
