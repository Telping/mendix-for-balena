import{n as A,m as y,M as F,T as $,P as b,$ as m,C as P,H as T,j as U,k as C,O as G,V as L,u as R,l as k,p as B,s as H,t as O,w as M,x as W}from"./DTxgj959.js";import{i as _}from"./D-Sagn14.js";const w=A.get().getLogger(),q=y((i,u,v)=>{const a=F(v),[c]=u.useSlot(i.listenTo,"selection"),p=$(`Selected object for widget ${a}`,()=>{const e=c.dependOn(),d=Array.isArray(e)?e[e.length-1]:e;return d?b(d):m()});return P(i,u,v,p,e=>{if(mx.isOffline())return g(e),T(e).then(t=>(f(t,[]),t?b(t):m()));const d=U().getCachedObject(e);return d?(function(t){w.debug(`Using selected object '${t}' for widget ${a}`)}(e),d.isUnavailable()?m():b(d)):(g(e),C().retrieveByPath(e,G(i.operationId)).then(({mxObjects:t,extra:s})=>{const r=t.length?t[0]:void 0;return f(r,s),r?b(r):m()}))});function g(e){w.debug(i.operationId?`Fetching selected object '${e}' with operationId '${i.operationId}' for widget ${a}`:`Fetching selected object '${e}' for widget ${a}`)}function f(e,d){const t=e?.getGuid();w.debug(t?`Received selected object '${t}' and ${d.length} objects over schema for widget ${a}`:`Received no selected object for widget ${a}`,"extra ids:",d.map(s=>s.getGuid()))}}),z=y(({slot:i,type:u,initialValue:v},a,c)=>{const[p,g]=a.useSlot(c,i);L(p)===void 0&&v!==void 0&&g(v);const f=R(u,{}),e=$(`Submitted value '${i}' for widget ${c}`,()=>p.dependOn()),[d,t]=k(`Unsubmitted value of widget variable '${i}' for widget ${c}`,void 0),s=B.box(f,{deep:!1});let r;const V=H(e);return $(`Widget variable '${i}' for widget ${c}`,()=>{const n=e.dependOn();V.dependOn()!==n&&_(()=>t(void 0));const o=d.dependOn(),S=o!==void 0&&o.state==="unparsed"?void 0:o!==void 0?o.value:n,I=o!==void 0&&o.state==="unparsed"?o.value:s.get().format(o!==void 0?o.value:n);return{status:"available",validation:o!==void 0?o.message:void 0,universe:void 0,readOnly:!1,formatter:s.get(),value:S,displayValue:I,isList:!1,setValidator:l=>r=l,setFormatter:O(l=>s.set(l??f)),setTextValue:O(l=>function(j){const x=s.get().parse(j);x.valid?h(x.value):t({state:"unparsed",value:j,message:M("mendix.lib.Validations","invalid_value")})}(l)),setValue:O(l=>h(l))}});function h(n){W(n,u,!0);const o=r!==void 0?r(n):void 0;o!==void 0?t({state:"parsed",value:n,message:o}):g(n)}});export{z as A,q as O};
