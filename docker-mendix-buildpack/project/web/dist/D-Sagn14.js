import{ds as Re,O as p,dv as I,dw as E,b1 as Y,ba as j,a8 as ae,ad as P,dx as Ce,dy as ne,dz as Ne,cN as A,cL as g,d8 as F,cR as V,cP as ke,cM as De,dA as Le,dB as xe,dC as Ee,dD as je,dE as Ae,dF as Fe,af as _,dG as Ve,dH as Me,h as Be,dI as Ge,l as J,t as qe,T as O,s as ze,a6 as re,a5 as He,dJ as We,dK as Ye,dL as se,dM as _e,V as N,dN as Je,av as Qe,a4 as ie,a3 as Ue,aw as oe,m as ue,_ as Ke,as as Q,P as U,at as Xe,dO as ce,au as Ze,Q as et,aY as tt,M as at}from"./DTxgj959.js";function M(e,a,t){return{type:"conditional",condition:e,then:a,else:t}}function T(e,a,t){return{type:"function",name:e,parameters:t===void 0?[a]:[a,t]}}function w(e){return{type:"literal",value:e}}function nt(e){return{type:"literalNumeric",value:e}}function K(e,a){return a!==void 0?{type:"variable",variable:e,path:a}:{type:"variable",variable:e}}const de={};function le(e,a){de[e]=a}function fe(e){const a=I(e),t=de[e];if(a===void 0||t===void 0)throw new P(`Sort order item: invalid attribute id '${e}'`);return{attributePath:a.attributePath,sortable:t}}function rt(e){return e.map(a=>[fe(a[0]).attributePath,a[1]])}function st(e,a){return e.map(t=>{const n=Re(t[0],a);return le(n,!0),[n,t[1]]})}function it(e){const a=p(I(e[0])).attributePath,t=p(E(e[0])),n=K("currentObject",a);return t==="String"?T("toLowerCase",n):n}function ot(e){return function(a,t){let n=0;for(let r=0;r<e.length&&n===0;r++){const i=a.sortValues[r],s=t.sortValues[r],l=p(e[r]),c=l[1]==="asc"?1:-1;if(i!==s){if(i===void 0||i===""){n=c;break}if(s===void 0||s===""){n=-c;break}switch(p(E(l[0]))){case"AutoNumber":n=j(i).cmp(j(s));break;case"String":case"Enum":case"HashString":n=i>s?1:-1;break;case"Long":case"Integer":case"Decimal":i instanceof j&&s instanceof j||Y(),n=i.cmp(s);break;case"DateTime":i instanceof Date&&s instanceof Date||Y(),n=i.getTime()>s.getTime()?1:-1;break;case"Boolean":n=i?1:-1;break;default:Y()}n*=c}}if(n===0){const r=p(e[0])[1]==="asc"?1:-1;n=a.mxObject.getGuid()>t.mxObject.getGuid()?r:-r}return n}}function me(e,a){return ae(e,a)}function ut(e,a){if(e===void 0)return!0;if(!Array.isArray(e))throw new P("Sort order: must be array");return e.forEach(t=>function(n){if(!Array.isArray(n)||n.length!==2)throw new P("Sort order item: must be an array with 2 elements");const[r,i]=n;if(!function(s){return fe(s).sortable}(r))throw new P(`Sort order item: attribute with id '${r}' is not sortable`);if(I(r).dataSourceId!==a)throw new P(`Sort order item: attribute with id '${r}' is linked to a different data source`);if(i!=="asc"&&i!=="desc")throw new P(`Sort order item: sort direction must be 'asc' or 'desc'. Got: '${i}'`)}(t)),!0}function ct(e){if(e===void 0)return"";const a=k(e);return`[${Ce(a)}]`}function R(e){switch(e.type){case"attribute":const a=p(I(e.attributeId)).attributePath;return K("currentObject",a);case"literal":return e.valueType==="Numeric"?nt(e.value):w(e.value??null);case"function":if("arg"in e)return T(e.name,R(e.arg));if("arg1"in e){if(!function(c){return c.name in be}(e))return R(pe(e));const n=function(c){switch(c.name){case"starts-with":case"ends-with":return!0;case"contains":case"=":case"!=":case">":case">=":case"<":case"<=":return ve(c.arg1)&&ve(c.arg2);default:return!1}}(e),r=c=>n?T("toLowerCase",c):c,i=r(R(e.arg1)),s=r(R(e.arg2)),l=T(be[e.name],i,s);return lt.includes(e.name)?M(T("=",i,w(null)),w(!1),M(T("=",s,w(null)),w(!1),l)):l}return e.args.map(R).reduce((n,r)=>e.name==="and"?M(n,r,w(!1)):M(n,w(!0),r));case"association":const t=p(ne(e.associationId)).associationPath;return K("currentObject",t)}}const dt=["day:=","day:!=","day:>","day:>=","day:<","day:<="];function pe(e){const a=e.arg1,t=Ne(e.arg2.value);switch(e.name){case"day:=":return De(V(a,g(t)),A(a,g(F(t,1))));case"day:!=":return ke(A(a,g(t)),V(a,g(F(t,1))));case"day:>":return V(a,g(F(t,1)));case"day:>=":return V(a,g(t));case"day:<":return A(a,g(t));case"day:<=":return A(a,g(F(t,1)))}}function ve(e){switch(e.type){case"literal":return e.valueType==="string";case"attribute":return p(E(e.attributeId))==="String";case"association":return!1}}const be={"=":"=","!=":"!=",">":">",">=":">=","<":"<","<=":"<=",contains:"contains","starts-with":"startsWith","ends-with":"endsWith"},lt=[">",">=","<","<="];function k(e,a=!1,t=!0){switch(e.type){case"attribute":return{type:"attribute",attribute:p(I(e.attributeId)).attributePath,attributeType:p(E(e.attributeId))};case"literal":return{type:"value",value:e.valueType==="DateTime"&&a?Ee(e.value):e.value,isGuid:e.valueType==="Reference"||e.valueType==="ReferenceSet"};case"function":if(function(s){return dt.includes(s.name)}(e))return k(pe(e));if(t&&(n=e).name==="="&&(he(n.arg1)||he(n.arg2)))return function(s){const l=k(s,!1,!1),c=[s.arg1,s.arg2].find(xe);if(c){const b=p(I(c.attributeId)).attributePath.split("/");if(b.length===1)return l;b.pop();const y=[l],S={type:"value",value:void 0,isGuid:!0};for(;b.length;){const C=b.join("/");b.splice(b.length-2,2),y.unshift({type:"function",name:"=",parameters:[{type:"association",associationPath:C,associationType:"Reference"},S]})}return{type:"function",name:"or",parameters:y}}return l}(e);const r="arg"in e?[e.arg]:"arg1"in e?[e.arg1,e.arg2]:e.args,i=r.some(ft);return{type:"function",name:e.name,parameters:r.map(s=>k(s,i))};case"association":return{type:"association",associationPath:p(ne(e.associationId)).associationPath,associationType:p(Le(e.associationId))}}var n}function ft(e){return e.type==="attribute"&&je(e.attributeId)}function he(e){return e.type==="literal"&&e.value===void 0}function ye(e){return Fe(()=>_(e))}Ae({enforceActions:"always"});const X=[];function $e(e){X.push(e),X.length===1&&setTimeout(()=>_(()=>X.splice(0).forEach(a=>a())),0)}function ge(e,a,t,n,r){const[i,s]=Ve(`Entity subscription of data source of ${n}`,t,{entity:e.entity}),l=e.refreshTime?Me(`Refresh of data source of ${n}`,e.refreshTime):Be(void 0),c=Ge(e.scope,t,n),b=function(m){const[o,W]=J(`Load delay of data source of ${m}`,!0);return setTimeout(qe(()=>W(!1)),1),o}(n),y=O(`Load breaker of ${n}`,()=>c.dependOn()&&!b.dependOn()),[S,C]=t.useSlot(n,`${e.dataSourceId}/limit`),B=O(`Return empty of ${n}`,()=>(S.dependOn()??Number.POSITIVE_INFINITY)<=0),G=ze(r),[D,q]=t.useSlot(n,`${e.dataSourceId}/sortOrder`),[L,x]=t.useSlot(n,`${e.dataSourceId}/filter`),[z,H]=J(`Reload ${n}`,[]);let u=-1;const d=O(`Load trigger of data source of ${n}`,()=>{if(i.dependOn(),l.dependOn(),z.dependOn(),y.dependOn()){const m=r.dependOn();return m.status==="unavailable"&&s(),re(m,o=>B.dependOn()?{empty:!0}:{empty:!1,parameters:o,id:++u})}return s(),He()}),v=We(t,n,d,s),[h,f]=t.useSlot(n,`${e.dataSourceId}/offset`),$=Ye(`Retrieve parameters info of data source of ${n}`,()=>{const m=S.dependOn();let o=h.dependOn();const W=D.dependOn(),Te=L.dependOn();if(y.dependOn()){const te=G.dependOn();te===void 0||ae(r.dependOn(),te)||(o=0,oe(()=>Z))}return{offset:o??0,limit:m??Number.POSITIVE_INFINITY,sortOrder:W??a,filter:Te}}),[Ie,Pe]=J(`Request total count of ${n}`,!1),Z=()=>$.muted(()=>f(0));return{fetchTrigger$:v,retrieveParameters$:$,silentlyResetOffset:Z,needTotalCount$:Ie,immediateRetrieveParametersSetters:ee(_),delayedRetrieveParametersSetters:ee($e),loadedCallback:s};function ee(m){return{setOffset(o){se(o)&&Number.isFinite(o)&&m(()=>f(o))},setLimit(o){(o===void 0||se(o))&&m(()=>C(Number.isFinite(o)?o:void 0))},requestTotalCount(o){_e(o)&&m(()=>Pe(o))},setSortOrder:o=>{ut(o,e.dataSourceId)&&m(()=>{me(N(D),o)||q(o)})},setFilter:o=>{Je(o,e.dataSourceId)&&m(()=>{Qe(N(L),o)||x(o)})},reload:()=>{m(()=>{H([])})}}}}function Oe(e,a,t,n){const r=n?`${t}/${n}`:t,[i,s]=a.useSlot(r,"firstLoadDone");return ie(`Share firstLoadDone state of ${r}`,e,l=>{N(i)||s(l.status!=="loading")})}function we(e){return Ue(e,a=>{const{filter:t,sortOrder:n,offset:r,limit:i,items:s,totalCount:l,hasMoreItems:c}=a;return{filter:t,sortOrder:n,offset:r,limit:i,items:s,totalCount:l,hasMoreItems:c}})}function Se(e,a,t,n){const[,r]=n.useSlot(e,`${a}/items`);return ie(`Published list value of data source: ${a}`,t,({status:i,items:s})=>r(i==="available"?{status:i,value:s}:{status:i}))}const mt=ue((e,a)=>{const[t,n]=a.useSlot(e.widgetId,"uniqueId");return O(`Derived unique id for ${e.widgetId}`,()=>{const r=N(t);if(r)return r;const i=Ke(e.widgetId);return ye(()=>n(i)),i})});function pt(e,a){let t;return(...n)=>{clearTimeout(t),t=window.setTimeout(function(){t=void 0,e(...n)},a)}}function vt(e,a,t,n,r){const{fetchTrigger$:i,retrieveParameters$:s,silentlyResetOffset:l,needTotalCount$:c,delayedRetrieveParametersSetters:b,immediateRetrieveParametersSetters:y,loadedCallback:S}=ge(e,[],a,t,n),C=Q(`Load data of ${t}`,()=>{const u=i.dependOn();return u.status!=="available"?u:u.value.empty?U({main:[],extra:[]}):r(u.value.parameters)}),B=Xe(t,a,C,u=>u.main.concat(u.extra)),G=O(`Filter of ${t}`,()=>s.dependOn().filter),D=Q(`Filtered data of ${t}`,()=>{const u=B.dependOn();return u.status!=="available"||u.value.main.length===0?re(u,d=>d.main):async function(d,v){if(!d)return v;const h=R(d);return(await Promise.all(v.map(f=>ce(h,f).then($=>$?f:void 0)))).filter(f=>!!f)}(G.dependOn(),u.value.main).then(d=>U(d))}),q=O(`Sort order of ${t}`,()=>s.dependOn().sortOrder),L=Q(`Sorted data of ${t}`,()=>{const u=D.dependOn();return u.status!=="available"||u.value.length===0?u:async function(d,v){return d.length===0?v:(await Promise.all(v.map(h=>Promise.all(d.map(f=>{const $=it(f);return ce($,h)})).then(f=>({sortValues:f,mxObject:h}))))).sort(ot(d)).map(h=>h.mxObject)}(q.dependOn(),u.value).then(d=>U(d))}),x=()=>a.addUpdateCallback(S),z=O(`Paged data of ${t}`,()=>{const u=L.dependOn();switch(u.status){case"loading":return{status:"loading",...N(s),...y};case"unavailable":return x(),{status:"unavailable",...s.dependOn(),...y};case"available":let{offset:d,limit:v,sortOrder:h,filter:f}=s.dependOn();return d>=u.value.length&&(d=0,oe(l)),x(),{status:"available",offset:d,limit:v,sortOrder:h,filter:f,items:u.value.slice(d,d+v).map($=>Ze($,e.dataSourceId)),totalCount:c.dependOn()?u.value.length:void 0,hasMoreItems:d+v<u.value.length||v===0,...b}}}),H=Se(t,e.dataSourceId,z,a);return we(Oe(H,a,t))}const bt=ue((e,a,t)=>{const n=et(tt(`Dynamic classes of ${at(t)}`,e.dynamicClasses,a));return O(`Dynamic class property of ${t}`,()=>{const r=n.dependOn().value;return`${e.staticClasses} ${r??""}`.trim()})});export{vt as H,rt as I,ct as N,st as T,me as V,mt as a,ge as b,bt as c,Oe as d,k as g,ye as i,Se as l,pt as n,$e as r,we as u,le as v};
